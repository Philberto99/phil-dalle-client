<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PhilGen v22</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
  <style>
    body { font-family: system-ui, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    header { display: flex; align-items: center; gap: .5rem; margin-bottom: 1rem; }
    .ok { color: #0a7a3f; font-weight: 600; }
    .title { font-family: 'Orbitron', sans-serif; font-size: 40px; color: #4B0082; }
    form { display: grid; gap: .75rem; margin-bottom: 1rem; }
    .prompt-row { display: flex; gap: 0.5rem; align-items: center; }
    input[type="text"] { padding: .6rem .8rem; font-size: 1rem; flex: 1; }
    #clear { cursor: pointer; font-size: 1.2rem; padding: 0 .5rem; }
    #clear:hover::after { content: " clear prompt"; font-size: 0.9rem; color: #555; margin-left: 0.3rem; }
    #surprise { padding: .6rem .9rem; font-size: 1rem; cursor: pointer; font-family: "Comic Sans MS", cursive, sans-serif; }
    button[type="submit"] { padding: .6rem .9rem; font-size: 1rem; cursor: pointer; }
    .status { min-height: 1.25rem; color: #555; }
    img { max-width: 100%; border: 1px solid #ddd; border-radius: 6px; }
    .result { margin-top: 1rem; }
    .result-block { margin-bottom: 2rem; }
    footer { margin-top: 3rem; font-size: .9rem; color: #777; text-align: center; }
    .radio-row { display: flex; gap: 3rem; flex-wrap: wrap; align-items: center; }
    .copy-btn { cursor: pointer; margin-left: 0.5rem; }
    .copy-btn:hover::after {
      content: " click here to copy url";
      font-size: 0.9rem;
      color: #555;
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <span class="ok">‚úÖ</span>
    <div class="title">PhilGen v22</div>
  </header>

  <p>Please enter below, a prompt of an image you would like PhilGen to create.</p>

  <form id="form">
    <div class="prompt-row">
      <input id="prompt" type="text" placeholder="e.g. A robot drinking sherry in Jerez" />
      <span id="clear">‚úñ</span>
      <button type="button" id="surprise">Surprise me</button>
    </div>

    <div class="radio-row">
      <div>
        <label>Quality:</label><br>
        <label><input type="radio" name="quality" value="standard" checked /> Standard</label>
        <label><input type="radio" name="quality" value="hd" /> HD</label>
      </div>

      <div>
        <label>Size:</label><br>
        <label><input type="radio" name="size" value="1024x1024" checked /> 1024√ó1024</label>
        <label><input type="radio" name="size" value="1024x1792" /> 1024√ó1792</label>
        <label><input type="radio" name="size" value="1792x1024" /> 1792√ó1024</label>
      </div>
    </div>

    <button type="submit">Generate</button>
    <div class="status" id="status"></div>
  </form>

  <div class="result" id="result"></div>

  <footer>
    UI version 22 üçå ‚Äî <a href="/health" target="_blank">health check</a>
  </footer>

  <script>
    const form = document.getElementById('form');
    const promptInput = document.getElementById('prompt');
    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');
    const surpriseBtn = document.getElementById('surprise');
    const clearBtn = document.getElementById('clear');

    const fruit = ['üçé','üçå','üçá','üçâ','üçë','üçç','ü•ù','üçí','üçä','üçì','ü•≠','üçê','üçåüîµ'];
    const chosenFruit = fruit[Math.floor(Math.random() * fruit.length)];
    document.querySelector('footer').innerHTML = `UI version 22 ${chosenFruit} ‚Äî <a href="/health" target="_blank">health check</a>`;

    const surprisePrompts = [
      "A neon jellyfish floating through a city skyline",
      "A vintage typewriter made of chocolate",
      "A futuristic flamenco dancer with robotic arms",
      "A cat made of clouds lounging on a rainbow",
      "A surreal olive tree growing out of a vinyl record",
      "A dragon sipping tea in a library",
      "A glowing crystal castle in the desert",
      "A robot chef making paella in Andalusia",
      "A cosmic whale swimming through the stars",
      "A medieval knight riding a giant snail",
      "A floating market on clouds",
      "A steampunk airship shaped like a lemon",
      "A phoenix rising from a cup of coffee",
      "A futuristic vineyard with robotic grape-pickers",
      "A surreal chessboard with living pieces",
      "A giant book opening into a forest",
      "A carnival of planets orbiting a sun",
      "A surreal flamenco dancer made of fire",
      "A glowing mushroom forest at night",
      "A quiet forest path at sunrise",
      "A mountain lake reflecting snowy peaks",
      "A sandy beach with seashells and gentle waves",
      "A rustic farmhouse surrounded by olive trees",
      "A field of sunflowers facing the sun"
    ];

    surpriseBtn.addEventListener('click', () => {
      const randomPrompt = surprisePrompts[Math.floor(Math.random() * surprisePrompts.length)];
      promptInput.value = randomPrompt;
    });

    clearBtn.addEventListener('click', () => {
      promptInput.value = '';
    });

    function getSelectedValue(name) {
      const selected = document.querySelector(`input[name="${name}"]:checked`);
      return selected ? selected.value : '';
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const prompt = promptInput.value.trim();
      const quality = getSelectedValue('quality');
      const size = getSelectedValue('size');

      if (!prompt) {
        statusEl.textContent = 'Please enter a prompt.';
        return;
      }

      const fullPrompt = `${prompt} [quality: ${quality}, size: ${size}]`;

      statusEl.textContent = 'Generating...';

      try {
        const res = await fetch('/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, quality, size })
        });

        const data = await res.json();
        if (!res.ok) {
          statusEl.textContent = data.error || 'Something went wrong.';
          console.error("Backend error:", data);
          return;
        }

        statusEl.textContent = `Done! (${data.footer || 'unknown backend version'})`;
        const url = data.image_url;

        const block = document.createElement('div');
        block.className = 'result-block';
        block.innerHTML = `
          <p><em>${fullPrompt}</em></p>
          <p><strong>Image URL:</strong>
            <span class="copy-btn" title="Click to copy URL" onclick="copyToClipboard('${url}')">üìã</span>&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="${url}" target="_blank" rel="noopener">View image here</a>
          </p>
          <img src="${url}" alt="Generated image" />
        `;

        resultEl.prepend(block);
      } catch (err) {
        statusEl.textContent = 'Network error.';
        console.error("Network error:", err);
      }
    });
  </script>
</body>
</html>